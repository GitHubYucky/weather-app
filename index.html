<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>å¤©æ°—äºˆå ±ã‚¢ãƒ—ãƒª</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        padding: 20px;
        background: linear-gradient(to top, #e0f7fa, #ffffff);
      }
      h1 {
        margin-bottom: 20px;
      }
      input,
      button {
        padding: 10px;
        font-size: 1em;
        margin: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
      button {
        cursor: pointer;
        background-color: #0288d1;
        color: white;
      }
      #weatherResult {
        margin-top: 20px;
        font-size: 1.2em;
        background-color: #ffffffcc;
        border-radius: 8px;
        padding: 15px;
        display: inline-block;
      }
      @media (max-width: 600px) {
        input,
        button {
          width: 90%;
          font-size: 1.2em;
        }
        #weatherResult {
          width: 90%;
          font-size: 1em;
        }
      }
    </style>
  </head>
  <body>
    <h1>å¤©æ°—äºˆå ±ã‚¢ãƒ—ãƒª</h1>
    <input type="text" id="cityInput" placeholder="éƒ½å¸‚åã‚’å…¥åŠ› (ä¾‹: Tokyo)" />
    <button onclick="getWeather()">å¤©æ°—ã‚’èª¿ã¹ã‚‹</button>

    <div id="weatherResult"></div>

    <script>
      function getWeatherDescription(code) {
        if (code === 0) return "æ™´ã‚Œ â˜€ï¸";
        if (code >= 1 && code <= 3) return "æ›‡ã‚Š ğŸŒ¥ï¸";
        if (code === 45 || code === 48) return "éœ§ ğŸŒ«ï¸";
        if (code >= 51 && code <= 67) return "å°é›¨ ğŸŒ¦ï¸";
        if (code >= 71 && code <= 77) return "é›ª â„ï¸";
        if (code >= 80 && code <= 82) return "ã«ã‚ã‹é›¨ ğŸŒ§ï¸";
        if (code >= 95) return "é›·é›¨ â›ˆï¸";
        return "ä¸æ˜";
      }

      async function getWeather() {
        const city = document.getElementById("cityInput").value.trim();
        const result = document.getElementById("weatherResult");
        if (!city) return alert("éƒ½å¸‚åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

        result.innerHTML = "å¤©æ°—ã‚’å–å¾—ä¸­...";

        try {
          // åœ°å â†’ ç·¯åº¦çµŒåº¦
          const geoRes = await fetch(
            `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(
              city
            )}`
          );
          const geoData = await geoRes.json();
          if (!geoData.results || geoData.results.length === 0) {
            result.innerHTML = "éƒ½å¸‚ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
            return;
          }
          const { latitude, longitude, name } = geoData.results[0];

          // å¤©æ°—å–å¾—
          const weatherRes = await fetch(
            `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`
          );
          const weatherData = await weatherRes.json();
          const weather = weatherData.current_weather;
          const description = getWeatherDescription(weather.weathercode);

          // çµæœè¡¨ç¤º
          result.innerHTML = `
          <p><strong>${name}</strong> ã®ç¾åœ¨ã®å¤©æ°—</p>
          <p>æ°—æ¸©ï¼š${weather.temperature}â„ƒ</p>
          <p>å¤©æ°—ï¼š${description}</p>
        `;
        } catch (error) {
          result.innerHTML = "å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
          console.error(error);
        }
      }
    </script>
  </body>
</html>
